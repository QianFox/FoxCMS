/*
 * @Descripttion :
 * @Author       : liuzhifang
 * @Date         : 2022-01-11 17:44:50
 * @LastEditors  : QianFox Team
 * @LastEditTime : 2024-09-02 14:27:39
 */
tinymce.PluginManager.add('imagesManager', function (editor) {
    var openImagesManager = function () {
        // 打开图片管理器
        foxui.imagesManager.show('<div data-subid="tinymce"></div>');
        foxui.imagesManager.onConfirm('tinymce', getImage);

        // 获取图片并添加至富文本框中
        function getImage(dataList) {
            // 将输入框内容插入到内容区光标位置
            let htmlArr = [];
            dataList.forEach(item => {
                htmlArr.push(`<img data-id="${item.id}" src="${item.url}"/>`);
            });
            editor.insertContent(htmlArr.join(''));
        }
    };

    // 注册一个工具栏按钮名称
    editor.ui.registry.addButton('imagesManager', {
        icon: 'image',
        tooltip: '选择图片',
        onAction: function () {
            openImagesManager();
        },
    });

    // 注册一个菜单项名称 menu/menubar
    editor.ui.registry.addMenuItem('imagesManager', {
        text: '选择图片',
        icon: 'image',
        onAction: function () {
            openImagesManager();
        },
    });

    return {
        getMetadata: function () {
            return {
                //插件名和链接会显示在“帮助”→“插件”→“已安装的插件”中
                name: 'imagesManager plugin', //插件名称
                url: '', //作者网址
            };
        },
    };
});
